/*! echoesworks 14-06-2015 */
!function(a,b){"use strict";function c(a){var b=a.replace("github.com","rawgit.com");return b=b.replace("raw.githubusercontent.com","rawgit.com")}var d=function(a){var c;c={element:"slide",source:"data/data.json",auto:!1},a===b&&(console.log("Default Options is Empty, use default options..."),a={}),d.defaults(a,c),this.options=a,this.source=this.options.source,this.element=this.options.element,this.playing=this.options.auto,this.totalTime=0,this.data=[],this.dataStatus=!1,this.fps=10,this.time=0,this.init()};d.prototype.init=function(){function a(a){return Math.max.apply(null,a)}var b=this;if(b.slide(),d.triggerEvent("ew:slide:init"),window.slide&&(setInterval(function(){b.update()},1e3/this.fps),b.parser(),"object"==typeof b.parser.data.times)){console.log(b.parser.data.times),b.data=b.parser.data,b.dataStatus=!0;var c=b.parser.parseTime(b.parser.data.times);b.totalTime=a(c)}},d.prototype.stop=function(){console.log("total time:",this.totalTime),this.playing=!1,this.time=0},d.prototype.pause=function(){this.playing=!1},d.prototype.play=function(){this.playing=!0},d.prototype.update=function(){this.playing&&(this.time+=1/this.fps),this.applyEchoes()},d.prototype.applyEchoes=function(){var a=this;if(a.dataStatus&&a.data){var b=a.parser.parseTime(a.data.times),c=window.slide.slide();if(parseFloat(a.time)>b[c])if(window.slide.next(),a.data.codes[c]){var e=d.fn.rawGitConvert(a.data.codes[c]);d.get(e,function(a){document.querySelector("pre").innerHTML=a,document.querySelector("slide").classList.remove("full"),document.querySelector("code").classList.remove("hidden")})}else document.querySelector("slide").classList.add("full"),document.querySelector("code").classList.add("hidden")}},d.VERSION="0.0.5",a.EchoesWorks=d,a.EW=d,d.isObject=function(a){var b=typeof a;return"function"===b||"object"===b&&!!a},d.isFunction=function(a){return"function"==typeof a||!1},d.defaults=function(a){if(!d.isObject(a))return a;for(var b=1,c=arguments.length;c>b;b++){var e=arguments[b];for(var f in e)void 0===a[f]&&(a[f]=e[f])}return a},d.extend=function(a){if(!d.isObject(a))return a;for(var b,c,e=1,f=arguments.length;f>e;e++){b=arguments[e];for(c in b)hasOwnProperty.call(b,c)&&(a[c]=b[c])}return a},d.triggerEvent=function(a){var b=document.createEvent("Event");b.initEvent(a,!0,!0),document.dispatchEvent(b)},d.forEach=function(a,b,c){if("[object Object]"===Object.prototype.toString.call(a))for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&b.call(c,a[d],d,a);else for(var e=0,f=a.length;f>e;e++)b.call(c,a[e],e,a)},d.get=function(a,b){d.send(a,"GET",b)},d.load=function(a,b){d.send(a,"GET",b)},d.post=function(a,b,c){d.send(a,"POST",c,b)},d.send=function(a,b,c,d){d=d||null;var e=new XMLHttpRequest;c instanceof Function&&(e.onreadystatechange=function(){4!==e.readyState||200!==e.status&&0!==e.status||c(e.responseText)}),e.open(b,a,!0),e.send(d)};var e=function(){var a=this.options.element,b=1===a.nodeType?a:document.querySelector(a),c=[].filter.call(b.children,function(a){return"SCRIPT"!==a.nodeName}),d=c[0],e={},f=function(){var a=window.location.hash,b=a.replace(/#|\//gi,"");g(b>0?b:0)},g=function(a,b){c[a]&&(d.className=d.className.replace(new RegExp("active(\\s|$)","g")," ").trim(),l("deactivate",m(d,b)),d=c[a],d.classList.add("active"),0===a&&d.classList.add("first"),i(a),l("activate",m(d,b)))},h=function(a,b){return arguments.length?void(l("slide",m(c[a],b))&&g(a,b)):c.indexOf(d)},i=function(a){window.location.hash="#/"+a},j=function(a,b){var e=c.indexOf(d)+a;l(a>0?"next":"prev",m(d,b))&&g(e,b)},k=function(a,b){return(e[a]||(e[a]=[])).push(b),function(){e[a]=e[a].filter(function(a){return a!==b})}},l=function(a,b){return(e[a]||[]).reduce(function(a,c){return a&&c(b)!==!1},!0)},m=function(a,b){return b=b||{},b.index=c.indexOf(a),b.slide=a,b},n={on:k,fire:l,slide:h,next:j.bind(null,1),prev:j.bind(null,-1),parent:b,slides:c};return f(),window.slide=n,n};d.prototype=d.extend(d.prototype,{slide:e});var f=function(){var a=this;f.init(a.source)};f.data=[],f.init=function(a){var b=new XMLHttpRequest;b.onreadystatechange=function(){4!==b.readyState||200!==b.status&&0!==b.status||f.parse(JSON.parse(b.responseText))},b.open("GET",a,!0),b.setRequestHeader("X-Requested-With","XMLHttpRequest"),b.send()},f.parse=function(a){function b(a){d.push(a.time),e.push(a.code),g.push(a.word)}var c,d=[],e=[],g=[];return a.forEach(b),c={times:d,codes:e,words:g},f.data=c,c},f.parseTime=function(a){var b=/\[\d{2}:\d{2}.\d{2}\]/g,c=[];return a.forEach(function(a){var d=a.slice(1,-1).split(":"),e=a.replace(b,"");c.push([60*parseFloat(d[0])+parseFloat(d[1]),e][0])}),c},d.prototype=d.extend(d.prototype,{parser:f});var g={regexobject:{headline:/^(\#{1,6})([^\#\n]+)$/m,pre:/\s\`\`\`(\w+)\n?[^`]+\`\`\`/g,code:/\s\`\`\`\n?([^`]+)\`\`\`/g,hr:/^(?:([\*\-_] ?)+)\1\1$/gm,lists:/^((\s*((\*|\-)|\d(\.|\))) [^\n]+)\n)+/gm,bolditalic:/(?:([\*_~]{1,3}))([^\*_~\n]+[^\*_~\s])\1/g,links:/!?\[([^\]<>]+)\]\(([^ \)<>]+)( "[^\(\)\"]+")?\)/g,reflinks:/\[([^\]]+)\]\[([^\]]+)\]/g,smlinks:/\@([a-z0-9]{3,})\@(t|gh|fb|gp|adn)/gi,mail:/<(([a-z0-9_\-\.])+\@([a-z0-9_\-\.])+\.([a-z]{2,7}))>/gim,tables:/\n(([^|\n]+ *\| *)+([^|\n]+\n))((:?\-+:?\|)+(:?\-+:?)*\n)((([^|\n]+ *\| *)+([^|\n]+)\n)+)/g,include:/[\[<]include (\S+) from (https?:\/\/[a-z0-9\.\-]+\.[a-z]{2,9}[a-z0-9\.\-\?\&\/]+)[\]>]/gi,url:/<([a-zA-Z0-9@:%_\+.~#?&\/\/=]{2,256}\.[a-z]{2,4}\b(\/[\-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)?)>/g},codeHandler:function(a,b){var c,d="";return null!==(c=this.regexobject.pre.exec(a))&&(d=c[1]),b.replace(a[0],'<pre><code class="'+d+'">\n'+g.htmlEncode(a[1]).replace(d+"\n","").replace(/\n/gm,"<br/>").replace(/\ /gm,"&nbsp;")+"</code></pre>\n")},headlineHandler:function(a,b){var c=a[1].length;return b.replace(a[0],"<h"+c+">"+a[2]+"</h"+c+">\n")},linksHandler:function(a,b,c){return b="!"===a[0].substr(0,1)?b.replace(a[0],'<img src="'+a[2]+'" alt="'+a[1]+'" title="'+a[1]+'" />\n'):b.replace(a[0],"<a "+g.mmdCSSclass(a[2],c)+'href="'+a[2]+'">'+a[1]+"</a>\n")},mailHandler:function(a,b){return b.replace(a[0],'<a href="mailto:'+a[1]+'">'+a[1]+"</a>")},hrHandler:function(a,b){return b.replace(a[0],"\n<hr/>\n")},urlHandler:function(a,b,c){var d=a[1];return-1===d.indexOf("://")&&(d="http://"+d),b.replace(a[0],"<a "+g.mmdCSSclass(d,c)+'href="'+d+'">'+d.replace(/(https:\/\/|http:\/\/|mailto:|ftp:\/\/)/gim,"")+"</a>")},refLinksHandler:function(a,b,c,d){return a.replace(b[0],"<a "+g.mmdCSSclass(c[1],d)+'href="'+c[1]+'">'+b[1]+"</a>")},smlinksHandler:function(a,b,c){var d="";switch(a[2]){case"t":d="https://twitter.com/"+a[1];break;case"gh":d="https://github.com/"+a[1];break;case"fb":d="https://www.facebook.com/"+a[1];break;case"gp":d="https://plus.google.com/+"+a[1]}return b.replace(a[0],"<a "+g.mmdCSSclass(d,c)+'href="'+d+'">'+a[1]+"</a>")},boldItalicHandler:function(a,b){var c=[];if("~~"===a[1])b=b.replace(a[0],"<del>"+a[2]+"</del>");else{switch(a[1].length){case 1:c=["<i>","</i>"];break;case 2:c=["<b>","</b>"];break;case 3:c=["<i><b>","</b></i>"]}b=b.replace(a[0],c[0]+a[2]+c[1])}return b},tableHandlerHelper:function(a,b,c){var d;for(d=0;d<a.length;d++)b.length<=d?b.push(0):":"===b[d].trimRight().slice(-1)&&c!==!0?":"===b[d][0]?b[d]=3:b[d]=2:c!==!0&&":"===b[d][0]?b[d]=1:b[d]=0},tableHandler:function(a,b,c,d,e){var f,g;if(g=a[b].split("|"),0!==g[0].length){for(;c.length<g.length;)c.push(0);for(d+="<tr>",f=0;f<g.length;f++)d+=e[c[f]]+g[f].trim()+"</td>";d+="</tr>\n"}return{helper2:g,repstr:d}},tablesHandler:function(a,b,c){var d,e,f,g,h,i,j;for(d="<table><tr>",f=a[1].split("|"),g=a[4].split("|"),this.tableHandlerHelper(f,g,c),e=["<th>",'<th align="left">','<th align="right">','<th align="center">'],j=0;j<f.length;j++)d+=e[g[j]]+f[j].trim()+"</th>";for(d+="</tr>",e=["<td>",'<td align="left">','<td align="right">','<td align="center">'],h=a[7].split("\n"),j=0;j<h.length;j++){var k=this.tableHandler(h,j,g,d,e);i=k.helper2,d=k.repstr}return d+="</table>",b.replace(a[0],d)},listHandlerStart:function(a,b){return b="*"===a[0].trim().substr(0,1)||"-"===a[0].trim().substr(0,1)?"<ul>":"<ol>"},listsHandlerEnd:function(a,b){return b+="*"===a[0].trim().substr(0,1)||"-"===a[0].trim().substr(0,1)?"</ul>":"</ol>"},listsHandlerSub:function(a,b,c){return"*"===a[0].trim().substr(0,1)||"-"===a[0].trim().substr(0,1)?(b+="<ul>",c.push("</ul>")):(b+="<ol>",c.push("</ol>")),b},listHandler:function(a,c,d,e,f,g){var h=!1;for(a[2]===b||0===a[2].length?c=0:(h===!1&&(h=a[2].replace(/\t/,"    ").length),c=Math.round(a[2].replace(/\t/,"    ").length/h));d>c;)e+=f.pop(),d--,g--;for(;c>d;)e=this.listsHandlerSub(a,e,f),d++,g++;return e+="<li>"+a[6]+"</li>\n",{nstatus:c,status:d,repstr:e,casca:g}},listsHandler:function(a,b){var c,d,e,f,g,h=[],i=0,j=0;for(f=this.listHandlerStart(a,f),c=a[0].split("\n"),g=0;g<c.length;g++)if(null!==(d=/^((\s*)((\*|\-)|\d(\.|\))) ([^\n]+))/.exec(c[g]))){var k=this.listHandler(d,e,i,f,h,j);e=k.nstatus,i=k.status,f=k.repstr,j=k.casca}for(;j>0;)f+="</ul>",j--;return f=this.listsHandlerEnd(a,f),b.replace(a[0],f+"\n")},listStrict:function(a,b){return a!==!0&&(b.lists=/^((\s*(\*|\d\.) [^\n]+)\n)+/gm),b.lists},removeRefLinks:function(a,b){var c;for(c=0;c<a.length;c++)b=b.replace(a[c],"");return b},parse:function(a,b){var c,d,e,f,h=[],i=this,j=g.regexobject;for(j.lists=this.listStrict(b,j),a="\n"+a+"\n",["code","headline","lists","tables","links","mail","url","smlinks","hr"].forEach(function(c){for(;null!==(e=j[c].exec(a));)a=i[c+"Handler"].apply(i,[e,a,b])}),f=0;3>f;f++)for(;null!==(e=j.bolditalic.exec(a));)a=this.boldItalicHandler(e,a);for(;null!==(e=j.reflinks.exec(a));)d=new RegExp("\\["+e[2]+"\\]: ?([^ \n]+)","gi"),null!==(c=d.exec(a))&&(a=this.refLinksHandler(a,e,c,b),h.push(c[0]));return a=this.removeRefLinks(h,a),a.replace(/ {2,}[\n]{1,}/gim,"<br/><br/>")},htmlEncode:function(a){var b=document.createElement("div");return b.appendChild(document.createTextNode(a)),b.innerHTML},mmdCSSclass:function(a,b){var c;return-1!==a.indexOf("/")&&b!==!0?(c=a.split("/"),c=0===c[1].length?c[2].split("."):c[0].split("."),'class="mmd_'+c[c.length-2].replace(/[^\w\d]/g,"")+c[c.length-1]+'" '):""}};d.md=g;var h=function(a){var c=document.getElementsByTagName("img");return d.forEach(c,function(a){if(a!==b){var c=a.src,d=a.title;"background"===a.title&&(a.parentNode.style.backgroundImage="url('"+c+"')",a.parentNode.classList.add(d))}}),h.removeImages(),a};h.removeImages=function(){var a,b=document.getElementsByTagName("img");for(a=b.length-1;a>=0;a--)b[a].parentNode.removeChild(b[a])},d.imageHandler=h;var i,j,k,l,m,n,o={width:"100%",height:"4px",zIndex:9999,bottom:"0"},p={width:0,height:"100%",clear:"both",transition:"height .3s"};i=function(a,b){var c;for(c in b)a.style[c]=b[c];a.style["float"]="left"},l=function(){var a=this,b=this.width-this.here;.1>b&&b>-.1?(m.call(this,this.here),this.moving=!1,100==this.width&&(this.el.style.height=0,setTimeout(function(){a.cont.el.removeChild(a.el)},300))):(m.call(this,this.width-b/4),setTimeout(function(){a.go()},16))},m=function(a){this.width=a,this.el.style.width=this.width+"%"},n=function(){var a=new j(this);this.bars.unshift(a)},j=function(a){this.el=document.createElement("div"),this.el.style.backgroundColor="#F44336",this.width=0,this.here=0,this.moving=!1,this.cont=a,i(this.el,p),a.el.appendChild(this.el)},j.prototype.go=function(a){a?(this.here=a,this.moving||(this.moving=!0,l.call(this))):this.moving&&l.call(this)},k=function(){this.bars=[],this.el=document.createElement("div"),i(this.el,o),this.el.style.position="fixed",document.getElementsByTagName("body")[0].appendChild(this.el),n.call(this)},k.prototype.go=function(a){this.bars[0].go(a),100==a&&n.call(this)};var q=new k;window.bar=q,d.bar=q;var r={};d.fn=r;var s={rawGitConvert:c};d.fn=d.extend(d.fn,s)}(this),function(a){"use strict";function b(){var a=window.slide.slide()+1,b=window.slide.slides.length;return 100*a/b}var c=9,d=32,e=34,f=37,g=39,h=40,i=33,j=38;a.addEventListener("ew:slide:init",function(k){window.bar.go(b()),a.addEventListener("keydown",function(a){var b=a.keyCode;(b===c||b>=d&&e>=b||b>=f&&h>=b)&&a.preventDefault()},!1),a.addEventListener("keyup",function(a){var k=a.keyCode;if(k===c||k>=d&&e>=k||k>=f&&h>=k){switch(k){case i:case f:case j:window.slide.prev();break;case c:case d:case e:case g:case h:window.slide.next()}window.bar.go(b()),a.preventDefault()}})})}(document);